# Data Model: UI Kit Monorepo Extraction

**Feature**: 007-ui-kit-extraction
**Date**: 2026-01-01

## Overview

This feature involves extracting packages from one monorepo to another. The "data model" here represents the package structure, configuration files, and dependency relationships rather than traditional database entities.

## Entities

### 1. Package

A publishable npm module with independent versioning.

| Field            | Type                   | Description                                       |
| ---------------- | ---------------------- | ------------------------------------------------- |
| name             | string                 | npm package name (e.g., `@openzeppelin/ui-types`) |
| version          | semver                 | Current version (starts at 1.0.0)                 |
| description      | string                 | Package description for npm                       |
| main             | path                   | CommonJS entry point                              |
| module           | path                   | ESM entry point                                   |
| types            | path                   | TypeScript declarations entry                     |
| exports          | object                 | Package exports map                               |
| dependencies     | Record<string, string> | Runtime dependencies                              |
| peerDependencies | Record<string, string> | Peer dependencies (e.g., React)                   |
| devDependencies  | Record<string, string> | Development dependencies                          |

**Relationships**:

- Package → depends on → Package (internal workspace dependencies)
- Package → published to → npm Registry

### 2. Changeset

A file describing version changes and changelog entries.

| Field    | Type     | Description                 |
| -------- | -------- | --------------------------- |
| id       | string   | Unique changeset identifier |
| packages | string[] | Affected package names      |
| type     | enum     | `major`, `minor`, `patch`   |
| summary  | string   | Changelog entry text        |

**Lifecycle**:

1. Created → PR open with changeset file
2. Pending → PR merged to main
3. Consumed → Release PR merges, file deleted

### 3. Release

A coordinated npm publish operation.

| Field      | Type             | Description             |
| ---------- | ---------------- | ----------------------- |
| packages   | PackageRelease[] | Packages being released |
| provenance | SLSA attestation | Supply chain provenance |
| timestamp  | ISO 8601         | Release timestamp       |

**PackageRelease**:
| Field | Type | Description |
|-------|------|-------------|
| name | string | Package name |
| version | semver | New version |
| changelog | string | Version changelog |
| tarball | bytes | Package tarball |

### 4. Exported App Configuration

Configuration for apps generated by UI Builder export.

| Field               | Type                   | Description                      |
| ------------------- | ---------------------- | -------------------------------- |
| packageDependencies | Record<string, string> | UI Kit package versions          |
| environment         | enum                   | `local`, `staging`, `production` |
| versionStrategy     | function               | Maps env to version resolution   |

**Version Resolution**:

- `local`: `workspace:*` (monorepo development)
- `staging`: RC dist-tag or explicit RC version
- `production`: `^1.0.0` (semver range)

## Package Dependency Graph

```text
@openzeppelin/ui-types (no internal deps)
         │
         ▼
@openzeppelin/ui-utils
         │
    ┌────┴────┐
    ▼         ▼
ui-storage  ui-components
              │
         ┌────┴────┐
         ▼         ▼
    ui-renderer  ui-react
         │
         ▼
      ui-react
```

**Dependency Table**:

| Package         | Depends On                                             |
| --------------- | ------------------------------------------------------ |
| `ui-types`      | (none)                                                 |
| `ui-utils`      | `ui-types`                                             |
| `ui-styles`     | (none, CSS only)                                       |
| `ui-storage`    | `ui-utils`                                             |
| `ui-components` | `ui-types`, `ui-utils`                                 |
| `ui-renderer`   | `ui-types`, `ui-utils`, `ui-components`                |
| `ui-react`      | `ui-types`, `ui-utils`, `ui-components`, `ui-renderer` |

## Configuration Files

### package.json (root)

```json
{
  "name": "openzeppelin-ui",
  "private": true,
  "type": "module",
  "workspaces": { "packages": ["packages/*", "examples/*"] },
  "packageManager": "pnpm@10.22.0",
  "engines": { "node": ">=20.19.0" }
}
```

### pnpm-workspace.yaml

```yaml
packages:
  - 'packages/*'
  - 'examples/*'
  - '!**/node_modules/**'
```

### .changeset/config.json

```json
{
  "$schema": "https://unpkg.com/@changesets/config@3.0.0/schema.json",
  "changelog": ["@changesets/changelog-github", { "repo": "OpenZeppelin/openzeppelin-ui" }],
  "commit": false,
  "fixed": [],
  "linked": [],
  "access": "public",
  "baseBranch": "main",
  "updateInternalDependencies": "patch"
}
```

## State Transitions

### Package Lifecycle

```text
[Development] ──changeset──▶ [Staged] ──merge──▶ [Release PR] ──merge──▶ [Published]
     │                                                                        │
     └────────────────────── npm deprecate ◀──────────────────────────────────┘
                               (rollback)
```

### Migration State Machine

```text
[UI Builder Only] ──Phase 1──▶ [New Repo Created] ──Phase 2──▶ [Packages Published]
                                                                       │
                                        ┌──────────────────────────────┘
                                        ▼
                               [UI Builder Updated] ──verify──▶ [Migration Complete]
```

## Validation Rules

### Package Name Validation

- Must match pattern: `@openzeppelin/ui-[a-z]+`
- Must not contain `builder` string
- Must be unique within npm registry

### Version Validation

- Must follow semver (MAJOR.MINOR.PATCH)
- Initial version must be `1.0.0`
- Internal deps use `workspace:^` protocol

### Export Version Resolution

- `local` env → `workspace:*` only
- `staging` env → RC version or `rc` dist-tag
- `production` env → `^X.Y.Z` semver range

## Migration Mapping

| Current (ui-builder)                  | New (openzeppelin-ui)         |
| ------------------------------------- | ----------------------------- |
| `@openzeppelin/ui-builder-types`      | `@openzeppelin/ui-types`      |
| `@openzeppelin/ui-builder-utils`      | `@openzeppelin/ui-utils`      |
| `@openzeppelin/ui-builder-styles`     | `@openzeppelin/ui-styles`     |
| `@openzeppelin/ui-builder-ui`         | `@openzeppelin/ui-components` |
| `@openzeppelin/ui-builder-renderer`   | `@openzeppelin/ui-renderer`   |
| `@openzeppelin/ui-builder-react-core` | `@openzeppelin/ui-react`      |
| `@openzeppelin/ui-builder-storage`    | `@openzeppelin/ui-storage`    |
